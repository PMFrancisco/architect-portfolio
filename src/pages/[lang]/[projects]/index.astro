---
/**
 * Projects Listing Page (All Languages)
 * Single file handles both ES and EN
 */
import { getCollection } from 'astro:content';
import { getRelativeLocaleUrl } from 'astro:i18n';
import BaseLayout from '../../../layouts/BaseLayout.astro';
import Header from '../../../shared/ui/Header.astro';
import Footer from '../../../shared/ui/Footer.astro';
import Container from '../../../shared/ui/Container.astro';
import Section from '../../../shared/ui/Section.astro';
import Grid from '../../../shared/ui/Grid.astro';
import Typography from '../../../shared/ui/Typography.astro';
import ProjectCard from '../../../features/portfolio/ProjectCard.astro';
import ScrollReveal from '../../../shared/ui/ScrollReveal.astro';
import { type Lang } from '../../../shared/i18n/translations';

// Generate static paths for all language + projects path combinations
export async function getStaticPaths() {
  return [
    { params: { lang: 'es', projects: 'proyectos' } },
    { params: { lang: 'en', projects: 'projects' } },
  ];
}

const { lang, projects: projectsPath } = Astro.params as { lang: Lang; projects: string };

// Get projects for the current language
const allProjects = await getCollection('projects', ({ data }) => {
  return data.lang === lang && !data.draft;
});

// Sort by year (newest first), featured first
const projects = allProjects.sort((a, b) => {
  if (a.data.featured !== b.data.featured) {
    return a.data.featured ? -1 : 1;
  }
  return b.data.year - a.data.year;
});

// Localized content
const content = {
  es: {
    title: 'Proyectos | Arquitecto',
    label: 'Portafolio',
    heading: 'Proyectos Seleccionados',
    description: 'Una selección de proyectos de consultoría arquitectónica que demuestran mi enfoque en la resolución de problemas y la creación de valor.',
  },
  en: {
    title: 'Projects | Architect',
    label: 'Portfolio',
    heading: 'Selected Projects',
    description: 'A selection of architectural consulting projects that demonstrate my approach to problem-solving and value creation.',
  },
};

const c = content[lang];
---

<BaseLayout title={c.title} lang={lang}>
  <Header lang={lang} currentPath={getRelativeLocaleUrl(lang, `/${projectsPath}`)} />
  
  <main class="pt-16 md:pt-20">
    <!-- Hero -->
    <Section spacing="large">
      <Container>
        <ScrollReveal animation="fade-up">
          <div class="max-w-3xl">
            <Typography as="p" variant="label" color="muted" class="mb-4">
              {c.label}
            </Typography>
            <Typography as="h1" variant="h1" class="mb-6">
              {c.heading}
            </Typography>
            <Typography as="p" variant="body-large" color="muted">
              {c.description}
            </Typography>
          </div>
        </ScrollReveal>
      </Container>
    </Section>

    <!-- Projects Grid -->
    <Section spacing="large" background="muted">
      <Container>
        <Grid cols={12} gap="large">
          {projects.map((project, index) => (
            <ScrollReveal 
              animation="fade-up"
              delay={index * 100}
              class:list={[
                'col-span-4 md:col-span-4',
                project.data.featured && index === 0 ? 'lg:col-span-8' : 'lg:col-span-4'
              ]}
            >
              <ProjectCard
                title={project.data.title}
                slug={project.data.slug}
                category={project.data.category}
                year={project.data.year}
                location={project.data.location}
                description={project.data.description}
                image={project.data.images?.[0]}
                featured={project.data.featured && index === 0}
                lang={lang}
              />
            </ScrollReveal>
          ))}
        </Grid>
      </Container>
    </Section>
  </main>

  <Footer lang={lang} />
</BaseLayout>

